<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Epigenome-wide association study (EWAS) | Introduction to Epigenome-Wide Association Studies (EWAS)</title>
<meta name="author" content="Juan R. González, Mariona Bustamante, Sofía Aguilar &amp; Laura Balagué">
<meta name="description" content="In this chapter we will run an Epigenome-Wide Association Study (EWAS)  5.1 Install and load packages Today we will load these packages library(data.table) library(qqman) library(metafor)...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Chapter 5 Epigenome-wide association study (EWAS) | Introduction to Epigenome-Wide Association Studies (EWAS)">
<meta property="og:type" content="book">
<meta property="og:url" content="https://isglobal-brge.github.io/course_methylation/epigenome-wide-association-study-ewas-1.html">
<meta property="og:description" content="In this chapter we will run an Epigenome-Wide Association Study (EWAS)  5.1 Install and load packages Today we will load these packages library(data.table) library(qqman) library(metafor)...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Epigenome-wide association study (EWAS) | Introduction to Epigenome-Wide Association Studies (EWAS)">
<meta name="twitter:description" content="In this chapter we will run an Epigenome-Wide Association Study (EWAS)  5.1 Install and load packages Today we will load these packages library(data.table) library(qqman) library(metafor)...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.0/transition.js"></script><script src="libs/bs3compat-0.5.0/tabs.js"></script><script src="libs/bs3compat-0.5.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><link rel="icon" type="image/png" href="images/Logo_Sportomics_AI.jpg">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>
    
    <img id="cover" class="d-none d-lg-block" src="images/isglobal-logo.png" width="200"><div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introduction to Epigenome-Wide Association Studies (EWAS)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction to Epigenome-Wide Association Studies (EWAS)</a></li>
<li><a class="" href="resources-and-tools-for-epigenetics-in-bioconductor.html"><span class="header-section-number">1</span> Resources and tools for epigenetics in Bioconductor</a></li>
<li><a class="" href="pre-processing-of-dna-methylation-data.html"><span class="header-section-number">2</span> Pre-processing of DNA methylation data</a></li>
<li><a class="" href="epigenome-wide-association-study-ewas.html"><span class="header-section-number">3</span> Epigenome-wide association study (EWAS)</a></li>
<li><a class="" href="meta-analysis-of-epigenome-wide-association-studies-metaewas.html"><span class="header-section-number">4</span> Meta-analysis of epigenome-wide association studies (metaEWAS)</a></li>
<li><a class="active" href="epigenome-wide-association-study-ewas-1.html"><span class="header-section-number">5</span> Epigenome-wide association study (EWAS)</a></li>
<li><a class="" href="biological-interpretation-of-findings.html"><span class="header-section-number">6</span> Biological interpretation of findings</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epigenome-wide-association-study-ewas-1" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Epigenome-wide association study (EWAS)<a class="anchor" aria-label="anchor" href="#epigenome-wide-association-study-ewas-1"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter we will run an Epigenome-Wide Association Study (EWAS)</p>
<div id="install-and-load-packages-2" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Install and load packages<a class="anchor" aria-label="anchor" href="#install-and-load-packages-2"><i class="fas fa-link"></i></a>
</h2>
<p>Today we will load these packages</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenturner/qqman">qqman</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.metafor-project.org">metafor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/reshape">reshape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span></span>
<span><span class="co">#library(IlluminaHumanMethylation450kanno.ilmn12.hg19)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span><span class="co"># plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/GenomicRanges">GenomicRanges</a></span><span class="op">)</span> <span class="co"># prepare db for Manhattan plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bernatgel/karyoploteR">karyoploteR</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="load-ewas-results-by-cohort" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Load EWAS results by cohort<a class="anchor" aria-label="anchor" href="#load-ewas-results-by-cohort"><i class="fas fa-link"></i></a>
</h2>
<p>Here we will show an example to run the metaEWAS testing never smokers against
current smokers. Nevertheless, the same code can be applied to run other
analyses testing never vs former or current vs former.</p>
<p>We begin loading the Never vs Current EWAS results from 3 cohorts:
cohort1, cohort2 and cohort3.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EWASres.cohort1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Results.EWAS.cohort1.NeverVScurrent.txt"</span>,sep<span class="op">=</span><span class="st">","</span>,header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">EWASres.cohort2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Results.EWAS.cohort2.NeverVScurrent.txt"</span>,sep<span class="op">=</span><span class="st">","</span>,header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">EWASres.cohort3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Results.EWAS.cohort3.NeverVScurrent.txt"</span>,sep<span class="op">=</span><span class="st">","</span>,header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="quality-control-of-ewas-results-from-the-different-studies" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Quality control of EWAS results from the different studies<a class="anchor" aria-label="anchor" href="#quality-control-of-ewas-results-from-the-different-studies"><i class="fas fa-link"></i></a>
</h2>
<p>Before running the metaEWAS, it is really important to check the quality of the
EWAS results that we want combine through a meta-analysis.
This includes:
- examining inflation
- create a beta’s box plot
- create a precision plot</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Set wd</span></span>
<span></span>
<span><span class="co">#res.dir&lt;-"V:/analyses/Course_Intro_to_EWAS/results"</span></span>
<span><span class="co">#setwd(res.dir)</span></span>
<span></span>
<span><span class="co">#Create the directory to save EWAS results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"MA.results"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">res.dir</span>,<span class="st">"/MA.results"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"QC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">res.dir</span>,<span class="st">"/MA.results/QC"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="lambda-and-qqplot" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Lambda and qqplot<a class="anchor" aria-label="anchor" href="#lambda-and-qqplot"><i class="fas fa-link"></i></a>
</h3>
<p>We look to the lambda and the QQplot to examine inflation</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda.cohort1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">EWASres.cohort1</span><span class="op">$</span><span class="va">p.value</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">1</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="va">lambda.cohort2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">EWASres.cohort2</span><span class="op">$</span><span class="va">p.value</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">1</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lambda.cohort3</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">EWASres.cohort3</span><span class="op">$</span><span class="va">p.value</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">1</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lambdas</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">lambda.cohort1</span>,<span class="va">lambda.cohort2</span>,<span class="va">lambda.cohort3</span><span class="op">)</span></span>
<span><span class="va">lambdas</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">lambdas</span>,<span class="st">"Lambdas.NeverVScurrent.txt"</span>,sep<span class="op">=</span><span class="st">","</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#cohort 1</span></span>
<span><span class="va">pvals.cohort1</span><span class="op">&lt;-</span><span class="va">EWASres.cohort1</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/qqman/man/qq.html">qq</a></span><span class="op">(</span><span class="va">pvals.cohort1</span>,main<span class="op">=</span><span class="op">(</span><span class="st">"QQPlot EWAS cohort 1 smoking Never VS Current"</span><span class="op">)</span><span class="op">)</span> </span>
<span> </span>
<span><span class="co">#cohort 2</span></span>
<span><span class="va">pvals.cohort2</span><span class="op">&lt;-</span><span class="va">EWASres.cohort2</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/qqman/man/qq.html">qq</a></span><span class="op">(</span><span class="va">pvals.cohort2</span>,main<span class="op">=</span><span class="op">(</span><span class="st">"QQPlot EWAS cohort 2 smoking Never VS Current"</span><span class="op">)</span><span class="op">)</span> </span>
<span> </span>
<span><span class="co">#cohort 3</span></span>
<span><span class="va">pvals.cohort3</span><span class="op">&lt;-</span><span class="va">EWASres.cohort3</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/qqman/man/qq.html">qq</a></span><span class="op">(</span><span class="va">pvals.cohort3</span>,main<span class="op">=</span><span class="op">(</span><span class="st">"QQPlot EWAS cohort 3 smoking Never VS Current"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
</div>
<div id="box-plot-and-precision-plot" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Box plot and Precision plot<a class="anchor" aria-label="anchor" href="#box-plot-and-precision-plot"><i class="fas fa-link"></i></a>
</h3>
<p>We will create a beta’s box plot and a precision plot comparing the different EWAS results</p>
<p>First, we will prepare a dataframe with the beta information of the three cohorts.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#create df for Box plot</span></span>
<span></span>
<span><span class="va">QCPlot_cohort1</span><span class="op">&lt;-</span><span class="va">EWASres.cohort1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probeID"</span>,<span class="st">"coefficient"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">QCPlot_cohort1</span><span class="op">$</span><span class="va">Cohort</span><span class="op">&lt;-</span><span class="st">"cohort1"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">QCPlot_cohort1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QCPlot_cohort2</span><span class="op">&lt;-</span><span class="va">EWASres.cohort2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probeID"</span>,<span class="st">"coefficient"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">QCPlot_cohort2</span><span class="op">$</span><span class="va">Cohort</span><span class="op">&lt;-</span><span class="st">"cohort2"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">QCPlot_cohort2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QCPlot_cohort3</span><span class="op">&lt;-</span><span class="va">EWASres.cohort3</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probeID"</span>,<span class="st">"coefficient"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">QCPlot_cohort3</span><span class="op">$</span><span class="va">Cohort</span><span class="op">&lt;-</span><span class="st">"cohort3"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">QCPlot_cohort3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QCPlot.df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">QCPlot_cohort1</span>,<span class="va">QCPlot_cohort2</span>,<span class="va">QCPlot_cohort3</span><span class="op">)</span></span></code></pre></div>
<p>Beta’s Box plot</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">QCPlot.df</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Cohort</span>, y<span class="op">=</span><span class="va">coefficient</span>, fill<span class="op">=</span><span class="va">Cohort</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">p1</span></span></code></pre></div>
<p>Precision plot</p>
<p>By plotting 1 divided by the median of the effect SE against the square root of the sample size for each cohort.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">invSE_cohort1</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">EWASres.cohort1</span><span class="op">$</span><span class="va">coefficient.se</span><span class="op">)</span></span>
<span><span class="va">invSE_cohort2</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">EWASres.cohort2</span><span class="op">$</span><span class="va">coefficient.se</span><span class="op">)</span></span>
<span><span class="va">invSE_cohort3</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">EWASres.cohort3</span><span class="op">$</span><span class="va">coefficient.se</span><span class="op">)</span></span>
<span>                        </span>
<span></span>
<span><span class="va">precision</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cohort1"</span>,<span class="st">"cohort2"</span>,<span class="st">"cohort3"</span><span class="op">)</span>,</span>
<span>  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">188</span>, <span class="fl">176</span>, <span class="fl">166</span><span class="op">)</span>,</span>
<span>  invSE<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">invSE_cohort1</span>,<span class="va">invSE_cohort2</span>,<span class="va">invSE_cohort3</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">precision</span><span class="op">$</span><span class="va">sqrt_N</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">precision</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">precision</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">precision</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sqrt_N</span>, y<span class="op">=</span><span class="va">invSE</span>, color<span class="op">=</span><span class="va">Cohort</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">p2</span></span></code></pre></div>
</div>
</div>
<div id="statistical-methods-to-combine-results-from-different-studies-1" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Statistical methods to combine results from different studies<a class="anchor" aria-label="anchor" href="#statistical-methods-to-combine-results-from-different-studies-1"><i class="fas fa-link"></i></a>
</h2>
<p>We will combine the results through a fixed-effect weight meta-analysis using Metafor R package</p>
<div id="data-preparation-1" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation-1"><i class="fas fa-link"></i></a>
</h3>
<p>We want to create a dataframe merging the EWAS results from the three cohorts
(probeID, coefficient, se, p.value, n)</p>
<p>First, we subset the EWAS results to probeID, coefficient, se .p.value and n
and we change the name of the column in order to merge these results in a dataframe</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample_list &lt;- c("Results.EWAS.cohort1.NeverVScurrent.txt","Results.EWAS.cohort2.NeverVScurrent.txt","Results.EWAS.cohort3.NeverVScurrent.txt")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># translation.table &lt;- matrix(c("probeID", "probeID","probeID", "BETA","BETA","BETA", "SE", "SE","SE", "P_VAL", "P_VAL","P_VAL"), ncol=2, byrow=TRUE)</span></span>
<span><span class="co"># write.table(translation.table, "translation.table.txt")</span></span>
<span></span>
<span><span class="co"># EWASres.cohort1$N&lt;-188</span></span>
<span><span class="co"># EWASres.cohort1$N&lt;-176</span></span>
<span><span class="co"># EWASres.cohort1$N&lt;-166</span></span>
<span></span>
<span><span class="va">EWASres.cohort1</span><span class="op">&lt;-</span><span class="va">EWASres.cohort1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probeID"</span>,<span class="st">"coefficient"</span>, <span class="st">"coefficient.se"</span>,<span class="st">"p.value"</span>,<span class="st">"n"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">EWASres.cohort2</span><span class="op">&lt;-</span><span class="va">EWASres.cohort2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probeID"</span>,<span class="st">"coefficient"</span>, <span class="st">"coefficient.se"</span>,<span class="st">"p.value"</span>,<span class="st">"n"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">EWASres.cohort3</span><span class="op">&lt;-</span><span class="va">EWASres.cohort3</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probeID"</span>,<span class="st">"coefficient"</span>, <span class="st">"coefficient.se"</span>,<span class="st">"p.value"</span>,<span class="st">"n"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#sample_N &lt;- data.frame(file = sample_list, N = c(188,176,166), stringsAsFactors = FALSE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">EWASres.cohort1</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>, <span class="st">"coef_cohort1"</span>, <span class="st">"se_cohort1"</span>, <span class="st">"P_VAL_cohort1"</span>, <span class="st">"N_for_probe_cohort1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">EWASres.cohort2</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>, <span class="st">"coef_cohort2"</span>, <span class="st">"se_cohort2"</span>, <span class="st">"P_VAL_cohort2"</span>, <span class="st">"N_for_probe_cohort2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">EWASres.cohort3</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>, <span class="st">"coef_cohort3"</span>, <span class="st">"se_cohort3"</span>, <span class="st">"P_VAL_cohort3"</span>, <span class="st">"N_for_probe_cohort3"</span><span class="op">)</span></span></code></pre></div>
<p>Second, we merge the EWAS results of the 3 cohorts</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-merge.html">merge</a></span><span class="op">(</span><span class="va">EWASres.cohort1</span>, <span class="va">EWASres.cohort2</span>, by<span class="op">=</span><span class="st">"probe"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span>, all.y<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-merge.html">merge</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">EWASres.cohort3</span>, by<span class="op">=</span><span class="st">"probe"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span>, all.y<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p>Then, we create a new column with the total N of the metaEWAS and remove those
probes present in &lt;50% of the cohorts</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N_for_probe_cohort1"</span>, <span class="st">"N_for_probe_cohort2"</span>, <span class="st">"N_for_probe_cohort3"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">totN</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">N_for_probe_cohort1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">N_for_probe_cohort2</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">N_for_probe_cohort3</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">datN</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>, <span class="st">"N_for_probe_cohort1"</span>, <span class="st">"N_for_probe_cohort2"</span>, <span class="st">"N_for_probe_cohort3"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">datN</span> <span class="op">&lt;-</span> <span class="va">datN</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">rowMeans</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">datN</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&gt;=</span><span class="fl">0.5</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html">which</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">probe</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html">%in%</a></span> <span class="va">datN</span><span class="op">$</span><span class="va">probe</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">dat</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html">which</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">N</span> <span class="op">&gt;=</span> <span class="va">totN</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">studies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cohort1"</span>,<span class="st">"cohort2"</span>,<span class="st">"cohort3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="run-fixed-effect-meta-analysis" class="section level3" number="5.4.2">
<h3>
<span class="header-section-number">5.4.2</span> Run fixed effect meta-analysis<a class="anchor" aria-label="anchor" href="#run-fixed-effect-meta-analysis"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed.effects.meta.analysis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">list.of.studies</span>,<span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://www.metafor-project.org">metafor</a></span><span class="op">)</span></span>
<span>  <span class="va">coefs</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"coef_"</span>,<span class="va">list.of.studies</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">ses</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"se_"</span>,<span class="va">list.of.studies</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/reshape">reshape</a></span><span class="op">)</span></span>
<span>  <span class="va">coefs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape/man/melt-24.html">melt</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span></span>
<span>  <span class="va">coefs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coefs</span>, <span class="fu"><a href="https://rdrr.io/pkg/reshape/man/colsplit-9h.html">colsplit</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">$</span><span class="va">variable</span>, <span class="st">"_"</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"var"</span>, <span class="st">"study"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">coefs</span> <span class="op">&lt;-</span> <span class="va">coefs</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>,<span class="st">"study"</span>,<span class="st">"value"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>,<span class="st">"study"</span>,<span class="st">"coef"</span><span class="op">)</span></span>
<span>  <span class="va">ses</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape/man/melt-24.html">melt</a></span><span class="op">(</span><span class="va">ses</span><span class="op">)</span></span>
<span>  <span class="va">data.long</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coefs</span>,<span class="va">ses</span><span class="op">[</span>,<span class="st">"value"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data.long</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>,<span class="st">"study"</span>,<span class="st">"coef"</span>,<span class="st">"se"</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/splitAsList.html">split</a></span><span class="op">(</span><span class="va">data.long</span>, f<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">probe</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/rma.uni.html">rma.uni</a></span><span class="op">(</span>slab<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">study</span>, yi<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">coef</span>,sei<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">se</span>,method<span class="op">=</span><span class="st">"FE"</span>,weighted<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">res</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract.and.merge.meta.analysis</span> <span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">meta.res</span>,<span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span></span>
<span>  <span class="va">data.meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">meta.res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"se"</span>,<span class="st">"pval"</span>,<span class="st">"QE"</span>,<span class="st">"QEp"</span>,<span class="st">"I2"</span>,<span class="st">"H2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">data.meta</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"probe"</span>,<span class="st">"coef.fe"</span>,<span class="st">"se.fe"</span>,<span class="st">"p.fe"</span>,<span class="st">"q.fe"</span>,<span class="st">"het.p.fe"</span>,<span class="st">"i2.fe"</span>,<span class="st">"h2.fe"</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-merge.html">merge</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">data.meta</span>,by<span class="op">=</span><span class="st">"probe"</span>,all.x<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To run the Never vs Current metaEWAS, we will use tha above functions (without edition)</p>
<ul>
<li>fixed.effects.meta.analysis function</li>
<li>extract.and.merge.meta.analysis function</li>
</ul>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta.results.current</span> <span class="op">&lt;-</span> <span class="fu">fixed.effects.meta.analysis</span><span class="op">(</span>list.of.studies <span class="op">=</span> <span class="va">studies</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">dat.current</span> <span class="op">&lt;-</span> <span class="fu">extract.and.merge.meta.analysis</span><span class="op">(</span>meta.res <span class="op">=</span> <span class="va">meta.results.current</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">dat.current</span><span class="op">$</span><span class="va">fdr</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">dat.current</span><span class="op">$</span><span class="va">p.fe</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat.current</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="explore-the-results" class="section level3" number="5.4.3">
<h3>
<span class="header-section-number">5.4.3</span> Explore the results<a class="anchor" aria-label="anchor" href="#explore-the-results"><i class="fas fa-link"></i></a>
</h3>
<p>We order the results by the metaEWAS p.value</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat.current.ord</span><span class="op">&lt;-</span><span class="va">dat.current</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html">order</a></span><span class="op">(</span><span class="va">dat.current</span><span class="op">$</span><span class="va">p.fe</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">dat.current.ord</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">xxxx</span><span class="op">)</span></span></code></pre></div>
<p>Significant hits
Our results were corrected for multiple testing using FDR method. Significance
was defined at FDR p-value &lt; 0.05.</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig.current</span><span class="op">&lt;-</span><span class="va">dat.current.ord</span><span class="op">[</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;</span><span class="fl">0.05</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sig.current</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sig.current</span><span class="op">)</span></span></code></pre></div>
<p>Lambda and QQplot</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda.current</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">p.fe</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">1</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">qchisq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lambda.current</span> </span></code></pre></div>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pvals.current</span><span class="op">&lt;-</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">p.fe</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/qqman/man/qq.html">qq</a></span><span class="op">(</span><span class="va">pvals.current</span>,main<span class="op">=</span><span class="op">(</span><span class="st">"QQPlot metaEWAS smoking Never VS Current"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Volcano plot</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">diffexpressed</span> <span class="op">&lt;-</span> <span class="st">"NO"</span></span>
<span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">diffexpressed</span><span class="op">[</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">coef.fe</span>  <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">dat.current.ord</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;</span><span class="fl">0.05</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"POSITIVE"</span></span>
<span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">diffexpressed</span><span class="op">[</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">coef.fe</span>  <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">dat.current.ord</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;</span><span class="fl">0.05</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"NEGATIVE"</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat.current.ord</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">coef.fe</span>, y<span class="op">=</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">p.fe</span><span class="op">)</span>, col<span class="op">=</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">diffexpressed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">130</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">" "</span>, x <span class="op">=</span> <span class="st">"beta"</span>, y <span class="op">=</span> <span class="st">"-log10(P-value)"</span>, colour <span class="op">=</span> <span class="st">"Effect"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Helvetica"</span>, size <span class="op">=</span> <span class="fl">14</span>, color <span class="op">=</span> <span class="st">"black"</span>,vjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Helvetica"</span>,size<span class="op">=</span><span class="fl">14</span>,face<span class="op">=</span><span class="st">"bold"</span>,color<span class="op">=</span><span class="st">"black"</span>, hjust<span class="op">=</span> <span class="fl">0.5</span>, vjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Helvetica"</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.012</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mycolors</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#157F8D"</span>,<span class="st">"#AF8D9B"</span>, <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mycolors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"POSITIVE"</span>, <span class="st">"NEGATIVE"</span>, <span class="st">"NO"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">mycolors</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span></span></code></pre></div>
<p>Forest plot</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Forest plots</span></span>
<span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="st">"cg05575921"</span></span>
<span><span class="va">G</span><span class="op">&lt;-</span><span class="st">"AHRR"</span></span>
<span><span class="va">I2</span><span class="op">&lt;-</span><span class="va">dat.current.ord</span><span class="op">$</span><span class="va">i2.fe</span></span>
<span><span class="fu"><a href="https://wviechtb.github.io/metafor/reference/forest.html">forest</a></span><span class="op">(</span><span class="va">meta.results.current</span><span class="op">$</span><span class="va">cg05575921</span>,digits<span class="op">=</span><span class="fl">4</span>,</span>
<span>       xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Change in DNA methylation never vs current"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       mlab<span class="op">=</span><span class="st">"Fixed-effects meta-analysis"</span>,col<span class="op">=</span><span class="st">"deepskyblue2"</span>,border<span class="op">=</span><span class="st">"deepskyblue2"</span>,cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="co">#title(paste0("Forest plot for probe:\n", X," (",G,"), I-squared: ",I2,""),line=-2)</span></span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="meta-analysis-of-epigenome-wide-association-studies-metaewas.html"><span class="header-section-number">4</span> Meta-analysis of epigenome-wide association studies (metaEWAS)</a></div>
<div class="next"><a href="biological-interpretation-of-findings.html"><span class="header-section-number">6</span> Biological interpretation of findings</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epigenome-wide-association-study-ewas-1"><span class="header-section-number">5</span> Epigenome-wide association study (EWAS)</a></li>
<li><a class="nav-link" href="#install-and-load-packages-2"><span class="header-section-number">5.1</span> Install and load packages</a></li>
<li><a class="nav-link" href="#load-ewas-results-by-cohort"><span class="header-section-number">5.2</span> Load EWAS results by cohort</a></li>
<li>
<a class="nav-link" href="#quality-control-of-ewas-results-from-the-different-studies"><span class="header-section-number">5.3</span> Quality control of EWAS results from the different studies</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#lambda-and-qqplot"><span class="header-section-number">5.3.1</span> Lambda and qqplot</a></li>
<li><a class="nav-link" href="#box-plot-and-precision-plot"><span class="header-section-number">5.3.2</span> Box plot and Precision plot</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#statistical-methods-to-combine-results-from-different-studies-1"><span class="header-section-number">5.4</span> Statistical methods to combine results from different studies</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-preparation-1"><span class="header-section-number">5.4.1</span> Data preparation</a></li>
<li><a class="nav-link" href="#run-fixed-effect-meta-analysis"><span class="header-section-number">5.4.2</span> Run fixed effect meta-analysis</a></li>
<li><a class="nav-link" href="#explore-the-results"><span class="header-section-number">5.4.3</span> Explore the results</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
  

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introduction to Epigenome-Wide Association Studies (EWAS)</strong>" was written by Juan R. González, Mariona Bustamante, Sofía Aguilar &amp; Laura Balagué. It was last built on 2023-08-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
